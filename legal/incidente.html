<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>NineChat – Abrir Incidente</title>

  <!-- FAVICON SVG -->
  <link rel="icon" href="../image/favicon.png">
  <style>
    :root{--primary:#0066FF;--secondary:#00D9B8;--dark:#0B1220;--gray:#6B7280;--light:#F3F4F6;--white:#fff}
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:system-ui,-apple-system,'Segoe UI',Roboto,Ubuntu,sans-serif;color:var(--dark);background:#fff;line-height:1.6}
    .wrap{max-width:920px;margin:0 auto;padding:24px}
    header{display:flex;align-items:center;gap:14px;margin:8px 0 18px}
    header img{height:28px}
    h1{font-size:1.55rem;letter-spacing:-.02em}
    .card{background:#fff;border:1px solid #E5E7EB;border-radius:18px;padding:18px;box-shadow:0 10px 28px rgba(0,0,0,.06)}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:14px}
    .grid .full{grid-column:1/-1}
    label{display:block;font-weight:800;font-size:.92rem;margin-bottom:6px}
    input,select,textarea{width:100%;padding:12px;border:1px solid #E5E7EB;border-radius:12px;font-size:1rem;background:#fff;outline:none;transition:border .2s,box-shadow .2s}
    input:focus,select:focus,textarea:focus{border-color:var(--primary);box-shadow:0 0 0 4px rgba(0,102,255,.12)}
    .row{display:flex;gap:10px;align-items:center}
    .muted{color:var(--gray);font-size:.92rem}
    .actions{display:flex;gap:10px;align-items:center;margin-top:10px}
    .btn{border:none;border-radius:999px;padding:12px 18px;font-weight:900;cursor:pointer}
    .btn-primary{background:var(--primary);color:#fff}
    .note{color:var(--gray);font-size:.9rem}
    .tagline{margin:-2px 0 12px;color:#4B5563}

    /* Modal sucesso */
    .success-overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(10,16,30,.55);backdrop-filter:blur(6px);z-index:20;padding:16px}
    .success-overlay.open{display:flex;animation:fade .25s ease both}
    @keyframes fade{from{opacity:0}to{opacity:1}}
    .success-card{width:min(520px,100%);background:#0B1220;color:#E6F3FF;border:1px solid rgba(255,255,255,.12);border-radius:22px;padding:26px 22px 20px;box-shadow:0 30px 80px rgba(0,0,0,.45);text-align:center;transform:scale(.96);opacity:0;animation:pop .28s ease .08s both}
    @keyframes pop{to{transform:scale(1);opacity:1}}
    .check{display:flex;justify-content:center;margin-bottom:10px}
    .check svg{width:84px;height:84px}
    .circ{stroke:#00D9B8;stroke-width:6;fill:none;stroke-linecap:round;stroke-dasharray:265;stroke-dashoffset:265;animation:draw .7s ease forwards}
    .tick{stroke:#fff;stroke-width:6;fill:none;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:50;stroke-dashoffset:50;animation:draw .6s ease .3s forwards}
    @keyframes draw{to{stroke-dashoffset:0}}
    .success-title{font-size:1.2rem;font-weight:900;margin:4px 0}
    .success-sub{color:#B7C6FF}
    .btn-close{margin-top:12px;background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff}

    /* Mobile */
    @media (max-width:720px){
      .grid{grid-template-columns:1fr}
      input,select,textarea,.btn{font-size:16px} /* evita zoom no iOS */
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <img src="image/logo-front.png" alt="NineChat" />
      <h1>Abrir ticket de incidente</h1>
    </header>
    <p class="tagline muted">Use este formulário para comunicar indisponibilidades, degradações ou falhas em produção.</p>

    <form class="card" id="form-incidente" action="https://sendform-production.up.railway.app/api/incidente" method="POST" novalidate>
      <!-- honeypot -->
      <input type="text" name="website" tabindex="-1" autocomplete="off" style="position:absolute;left:-9999px" aria-hidden="true"/>

      <div class="grid">
        <div>
          <label for="nome">Seu nome *</label>
          <input id="nome" name="nome" required placeholder="Seu nome completo">
        </div>
        <div>
          <label for="email">E-mail *</label>
          <input id="email" name="email" type="email" required placeholder="voce@empresa.com">
        </div>

        <div>
          <label for="telefone">Telefone/WhatsApp</label>
          <input id="telefone" name="telefone" placeholder="(00) 00000-0000">
        </div>
        <div>
          <label for="empresa">Empresa *</label>
          <input id="empresa" name="empresa" required placeholder="Nome da empresa">
        </div>

        <div>
          <label for="servico">Serviço afetado *</label>
          <select id="servico" name="servico" required>
            <option value="" disabled selected>Selecione…</option>
            <option>WhatsApp</option>
            <option>Instagram</option>
            <option>Telegram</option>
            <option>Webchat</option>
            <option>API</option>
            <option>Outros</option>
          </select>
        </div>

        <div>
          <label for="severidade">Severidade *</label>
          <select id="severidade" name="severidade" required>
            <option value="" disabled selected>Selecione…</option>
            <option>Crítica</option>
            <option>Alta</option>
            <option>Média</option>
            <option>Baixa</option>
          </select>
        </div>

        <div>
          <label for="impacto">Impacto *</label>
          <select id="impacto" name="impacto" required>
            <option value="" disabled selected>Selecione…</option>
            <option>Todos os usuários</option>
            <option>Parcial dos usuários</option>
            <option>Usuário específico</option>
          </select>
        </div>

        <div>
          <label for="inicio">Início do incidente *</label>
          <input id="inicio" name="inicio" type="datetime-local" required>
        </div>

        <div>
          <label for="ambiente">Ambiente *</label>
          <select id="ambiente" name="ambiente" required>
            <option value="" disabled selected>Selecione…</option>
            <option>Produção</option>
            <option>Homologação</option>
            <option>Desenvolvimento</option>
          </select>
        </div>

        <div class="full">
          <label for="resumo">Título do incidente (curto) *</label>
          <input id="resumo" name="resumo" required placeholder="Ex.: Quedas intermitentes no Webchat">
        </div>

        <div class="full">
          <label for="descricao">Descrição detalhada *</label>
          <textarea id="descricao" name="descricao" rows="6" required placeholder="O que você observou? Quando começou? Quem é afetado? Passos para reproduzir, erros, etc."></textarea>
        </div>

        <div class="full">
          <label for="evidencias">Evidências (links, IDs, prints) – opcional</label>
          <textarea id="evidencias" name="evidencias" rows="3" placeholder="URLs de prints, IDs de conversa, códigos de erro…"></textarea>
        </div>

        <div class="row full">
          <input id="lgpd" type="checkbox" name="consentimento" required>
          <label for="lgpd" class="muted">Concordo com os <a href="/legal/terms.html">Termos de Uso</a> e a <a href="/legal/privacy.html">Política de Privacidade</a>.</label>
        </div>

        <!-- metadados -->
        <input type="hidden" name="origem" value="Site - Abrir Incidente">
        <input type="hidden" name="canal" value="Web">
      </div>

      <div class="actions">
        <button class="btn btn-primary" type="submit">Abrir incidente</button>
        <span class="note">Retorno humano em até 1 hora útil (SLA incidentes).</span>
      </div>

      <div id="status" aria-live="polite" style="margin-top:10px"></div>
    </form>
  </div>

  <!-- Modal sucesso -->
  <div class="success-overlay" id="modal-ok" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="success-card" role="document">
      <div class="check" aria-hidden="true">
        <svg viewBox="0 0 100 100"><circle class="circ" cx="50" cy="50" r="42"/><path class="tick" d="M30 52 L45 66 L72 38"/></svg>
      </div>
      <div class="success-title">Incidente registrado!</div>
      <div class="success-sub">Nossa equipe foi notificada e entrará em contato.</div>
      <button class="btn btn-close" id="ok-close" type="button">Fechar</button>
    </div>
  </div>

  <script>
    // modal
    (function(){
      const m = document.getElementById('modal-ok');
      const b = document.getElementById('ok-close');
      function open(){ m.classList.add('open'); m.setAttribute('aria-hidden','false'); b.focus(); }
      function close(){ m.classList.remove('open'); m.setAttribute('aria-hidden','true'); }
      b.addEventListener('click', close);
      m.addEventListener('click', (e)=>{ if(e.target===m) close(); });
      window.__openOK = open;
    })();

    // submit
    (function(){
      const form = document.getElementById('form-incidente');
      const statusBox = document.getElementById('status');
      const btn = form.querySelector('button[type="submit"]');

      function setStatus(type,msg){
        statusBox.innerHTML='';
        const el=document.createElement('div');
        el.style.padding='10px 12px'; el.style.borderRadius='12px'; el.style.border='1px solid';
        el.style.marginTop='8px'; el.style.fontSize='.95rem';
        if(type==='ok'){ el.style.background='#ECFDF5'; el.style.color='#065F46'; el.style.borderColor='#A7F3D0'; }
        else{ el.style.background='#FEF2F2'; el.style.color='#991B1B'; el.style.borderColor='#FECACA'; }
        el.textContent=msg; statusBox.appendChild(el);
      }

      form.addEventListener('submit', async (e)=>{
        e.preventDefault();
        if(!form.checkValidity()){ setStatus('err','Preencha os campos obrigatórios.'); return; }

        btn.disabled=true; const old=btn.textContent; btn.textContent='Enviando…';
        try{
          const fd=new FormData(form); const body=new URLSearchParams(); for(const [k,v] of fd.entries()) body.append(k,v);
          const resp=await fetch(form.action,{method:'POST',headers:{'Accept':'application/json','Content-Type':'application/x-www-form-urlencoded;charset=UTF-8'},body});
          if(resp.status===204 || resp.ok){
            form.reset(); statusBox.innerHTML=''; window.__openOK();
          }else{
            let detail=''; try{ const j=await resp.json(); detail=j.details||j.error||''; }catch{}
            setStatus('err','Não foi possível abrir agora. Tente novamente.'+(detail?` (${typeof detail==='string'?detail:JSON.stringify(detail)})`:''));
          }
        }catch(err){ setStatus('err','Falha de rede. Verifique sua conexão e tente novamente.'); }
        finally{ btn.disabled=false; btn.textContent=old; }
      });
    })();
  </script>
</body>
</html>
